source('~/.active-rstudio-document', echo=TRUE)
source('~/Desktop/Studium/SWP/Projekte/koalition/code/clean_text.R', echo=TRUE)
pdfs <- list.files('raw_data')
texts <- pdftools::pdf_text(pdfs)
pdfs
pdfs <- list.files('raw_data', full.names = T)
texts <- pdftools::pdf_text(pdfs)
texts <- pdftools::pdf_text(pdfs[1])
texts <- map_dfr(pdfs, ~pdf_text(.x) %>% tibble(text =.))
## define libraries to be loaded
packs <- c('tidyverse',"janitor",'openxlsx','pdftools','purrr')
p_load(char = packs)
pdfs <- list.files('raw_data', full.names = T)
## load packages and install missing packages
require("pacman")
## define libraries to be loaded
packs <- c('tidyverse',"janitor",'openxlsx','pdftools','purrr')
p_load(char = packs)
pdfs <- list.files('raw_data', full.names = T)
texts <- map_dfr(pdfs, ~pdf_text(.x) %>% tibble(text =.))
texts <- map_dfr(pdfs, ~pdf_text(.x) %>% tibble(text =., party = .x))
View(texts)
texts_clean <- texts %>%
mutate(text = str_squish(text) %>% str_trim())
View(texts_clean)
texts_clean <- texts %>%
mutate(text = str_squish(text) %>%
str_trim() %>%
str_remove_all(.,'^Bereit, weil Ihr es seid.') %>%
str_remove_all(.,'^Bundestagswahlprogramm 2021')
)
View(texts_clean)
texts_clean <- texts %>%
mutate(text = str_squish(text) %>%
str_trim() %>%
str_remove_all(.,'^Bereit, weil Ihr es seid.') %>%
str_remove_all(.,'^Bundestagswahlprogramm 2021') %>%
str_remove_all(.,'^Das Zukunftsprogramm der SPD')
)
View(texts_clean)
texts_clean <- texts %>%
mutate(text = str_squish(text) %>%
str_trim() %>%
str_remove_all(.,'^Bereit, weil Ihr es seid.') %>%
str_remove_all(.,'^Bundestagswahlprogramm 2021') %>%
str_remove_all(.,'^Das Zukunftsprogramm der SPD')
) %>%
mutate(text = iconv(text))
View(texts_clean)
texts_clean <- texts %>%
mutate(text = str_squish(text) %>%
str_trim() %>%
str_remove_all(.,'^Bereit, weil Ihr es seid.') %>%
str_remove_all(.,'^Bundestagswahlprogramm 2021') %>%
str_remove_all(.,'^Das Zukunftsprogramm der SPD')
) %>%
mutate(text = iconv(text, to = 'latin'))
?iconv
texts_clean <- texts %>%
mutate(text = str_squish(text) %>%
str_trim() %>%
str_remove_all(.,'^Bereit, weil Ihr es seid.') %>%
str_remove_all(.,'^Bundestagswahlprogramm 2021') %>%
str_remove_all(.,'^Das Zukunftsprogramm der SPD')
) %>%
mutate(text = iconv(text, to = 'latin1'))
View(texts_clean)
texts_clean <- texts %>%
mutate(text = str_squish(text) %>%
str_trim() %>%
str_remove_all(.,'^Bereit, weil Ihr es seid.') %>%
str_remove_all(.,'^Bundestagswahlprogramm 2021') %>%
str_remove_all(.,'^Das Zukunftsprogramm der SPD')
)
## load packages and install missing packages
require("pacman")
## define libraries to be loaded
packs <- c('tidyverse', "janitor", 'openxlsx',
'pdftools', 'purrr',
'quanteda.textstats')
p_load(char = packs)
## define libraries to be loaded
packs <- c('tidyverse', "janitor", 'openxlsx',
'pdftools', 'purrr',
'quanteda.textstats','quanteda')
p_load(char = packs)
corpus <- corpus(texts_celan)
corpus <- corpus(texts_clean)
corpus <- corpus(texts_clean)
tokens <- tokens(corpus)
dfm <- dfm(tokens)
textstat_frequency(dfm)
tokens <- tokens(corpus) %>%
tokens_remove(stopwords::stopwords('de'))
dfm <- dfm(tokens)
textstat_frequency(dfm,groups = 'party')
texts_clean <- texts %>%
mutate(text = str_squish(text) %>%
str_trim() %>%
str_remove_all(.,'^Bereit, weil Ihr es seid.') %>%
str_remove_all(.,'^Bundestagswahlprogramm 2021') %>%
str_remove_all(.,'^Das Zukunftsprogramm der SPD')
)%>%
mutate(party = str_remove_all(party, '^raw_data/'))
texts_clean <- texts %>%
mutate(text = str_squish(text) %>%
str_trim() %>%
str_remove_all(.,'^Bereit, weil Ihr es seid.') %>%
str_remove_all(.,'^Bundestagswahlprogramm 2021') %>%
str_remove_all(.,'^Das Zukunftsprogramm der SPD')
)%>%
mutate(party = str_remove_all(party, '^raw_data/') %>% str_remove(.,'//.pdf'))
texts_clean <- texts %>%
mutate(text = str_squish(text) %>%
str_trim() %>%
str_remove_all(.,'^Bereit, weil Ihr es seid.') %>%
str_remove_all(.,'^Bundestagswahlprogramm 2021') %>%
str_remove_all(.,'^Das Zukunftsprogramm der SPD')
) %>%
mutate(party = str_remove_all(party, '^raw_data/') %>% str_remove(.,'\\.pdf'))
corpus <- corpus(texts_clean)
tokens <- tokens(corpus) %>%
tokens_remove(stopwords::stopwords('de'))
dfm <- dfm(tokens)
freq <- textstat_frequency(dfm,groups = 'party')
View(freq)
View(freq)
tokens <- tokens(corpus, remove_punct = T) %>%
tokens_remove(stopwords::stopwords('de'))
dfm <- dfm(tokens)
freq <- textstat_frequency(dfm,groups = 'party') %>%
group_by(party) %>%
mutate(total = sum(frequency))
corpus <- corpus(texts_clean)
tokens <- tokens(corpus, remove_punct = T) %>%
tokens_remove(stopwords::stopwords('de'))
dfm <- dfm(tokens)
freq <- textstat_frequency(dfm,groups = 'party') %>%
group_by(party) %>%
mutate(total = sum(frequency))
corpus
docvars(corpus)
dfm
docvars(dfm)
freq <- textstat_frequency(dfm,groups = 'party') %>%
group_by(group) %>%
mutate(total = sum(frequency))
View(freq)
freq <- textstat_frequency(dfm,groups = 'party') %>%
group_by(group) %>%
mutate(total = sum(frequency)) %>%
slice_max(order_by = frequency, n = 20)
View(freq)
texts_collapsed <- texts_clean %>%
group_by(party) %>%
mutate(text = paste0(text, collapse = ' '))
texts_collapsed <- texts_clean %>%
group_by(party) %>%
summarise(text = paste0(text, collapse = ' '))
textstat_summary(dfm)
texts_collapsed <- texts_clean %>%
group_by(party) %>%
summarise(text = paste0(text, collapse = ' '))
corpus <- corpus(texts_collapsed)
tokens <- tokens(corpus, remove_punct = T) %>%
tokens_remove(stopwords::stopwords('de'))
dfm <- dfm(tokens)
textstat_summary(dfm)
docnames(corpus) <- texts_collapsed$party
tokens <- tokens(corpus, remove_punct = T) %>%
tokens_remove(stopwords::stopwords('de'))
dfm <- dfm(tokens)
textstat_summary(dfm)
textstat_dist(dfm)
quanteda.textstats::textstat_dist(dfm)
quanteda.textstats::textstat_simil(dfm)
?textstat_simil
textstat_simil(dfm)
textstat_simil(dfm, method = 'jaccard')
textstat_simil(dfm, method = 'cosine')
textstat_simil(dfm, method = 'cosine',margin = "documents")
quanteda.textstats::textstat_dist(dfm,dfm['koalition',])
quanteda.textstats::textstat_dist(dfm,dfm['koalition',], method = 'euclidean')
quanteda.textstats::textstat_dist(dfm,dfm['koalition',], method = 'canberra')
quanteda.textstats::textstat_dist(dfm,dfm['koalition',], method = 'manhattan')
textstat_simil(dfm, method = 'jaccard',margin = "documents")
## define libraries to be loaded
packs <- c('tidyverse', "janitor", 'openxlsx',
'pdftools', 'purrr',
'quanteda.textstats','quanteda','word2vec')
p_load(char = packs)
path  <- system.file(package = "word2vec", "models", "example.bin")
model <- read.word2vec(path)
x <- data.frame(doc_id = c("doc1", "doc2", "testmissingdata"),
text = c("there is no toilet. on the bus", "no tokens from dictionary", NA), stringsAsFactors = FALSE)
emb <- doc2vec(model, x, type = "embedding")
emb
newdoc <- doc2vec(model, "i like busses with a toilet")
predict.word2vec
word2vec_similarity(emb, newdoc)
model
model <- word2vec(texts_collapsed$text)
model
emb <- doc2vec(model, texts_collapsed$text[texts_collapsed$party == 'fdp'], type = "embedding")
emb
newdoc <- doc2vec(model, texts_collapsed$text[texts_collapsed$party == 'koalition'])
word2vec_similarity(emb, newdoc)
emb <- doc2vec(model, texts_collapsed$text[texts_collapsed$party == 'gruene'], type = "embedding")
newdoc <- doc2vec(model, texts_collapsed$text[texts_collapsed$party == 'koalition'])
word2vec_similarity(emb, newdoc)
emb <- doc2vec(model, texts_collapsed$text[texts_collapsed$party == 'spd'], type = "embedding")
newdoc <- doc2vec(model, texts_collapsed$text[texts_collapsed$party == 'koalition'])
word2vec_similarity(emb, newdoc)
View(texts_clean)
write_csv(texts_collapsed, file = 'raw_data/texts.csv')
## define libraries to be loaded
packs <- c('tidyverse', "janitor", 'openxlsx',
'pdftools', 'purrr',
'quanteda.textstats','quanteda','word2vec','tabulizer')
texts <- map_dfr(pdfs, ~if(str_detect(.x,'fdp')) tabulizer::extract_text() %>% tibble(text = ., party = .x) else pdf_text(.x) %>% tibble(text = ., party = .x))
texts <- map_dfr(pdfs, ~if(str_detect(.x,'fdp')) tabulizer::extract_text(.x) %>% tibble(text = ., party = .x) else pdf_text(.x) %>% tibble(text = ., party = .x))
View(texts)
texts_clean <- texts %>%
mutate(text = str_squish(text) %>%
str_trim() %>%
str_remove_all(.,'^Bereit, weil Ihr es seid.') %>%
str_remove_all(.,'^Bundestagswahlprogramm 2021') %>%
str_remove_all(.,'^Das Zukunftsprogramm der SPD')
) %>%
mutate(party = str_remove_all(party, '^raw_data/') %>% str_remove(.,'\\.pdf'))
View(texts_clean)
texts_collapsed <- texts_clean %>%
group_by(party) %>%
summarise(text = paste0(text, collapse = ' '))
texts_collapsed$text[1]
write_csv(texts_collapsed, file = 'raw_data/texts.csv')
csv <- readr::read_csv('results/matrix_fdp.csv')
fdp_data <- readr::read_csv('results/data_fdp.csv')
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
## empty potential rests from other scripts
rm(list = ls())
## load packages and install missing packages
require("pacman")
## define libraries to be loaded
packs <- c('tidyverse', "janitor", 'openxlsx',
'pdftools', 'purrr',
'quanteda.textstats','quanteda','word2vec','tabulizer')
p_load(char = packs)
fdp_matrix <- readr::read_csv('results/matrix_fdp.csv')
spd_matrix <- readr::read_csv('results/matrix_spd.csv')
gruene_matrix <- readr::read_csv('results/matrix_gruene.csv')
fdp_data <- readr::read_csv('results/data_fdp.csv')
coal_data <- readr::read_csv('results/data_coal.csv')
gruene_data <- readr::read_csv('results/data_gruene.csv')
spd_data <- readr::read_csv('results/data_spd.csv')
getwd()
fdp_matrix <- readr::read_csv('../results/matrix_fdp.csv')
source("~/Desktop/Studium/SWP/Projekte/koalition/code/analyze_results.R", echo=TRUE)
fdp_long <- fdp_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal')
View(fdp_long)
fdp_long <- fdp_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_party) %>%
slice_max(n = 3, order_by = value)
View(fdp_long)
fdp_data[fdp_data$index_party==2110]
fdp_data[fdp_data$index_party==2110,]
fdp_data[fdp_data$index_party==0,]
coal_data[coal_data$index_party == 2110]
coal_data[coal_data$index_party == 2110,]
coal_data[coal_data$index_party == 2653,]
coal_data[coal_data$index_party == 224,]
fdp_data[fdp_data$index_party==3,]
fdp_data <- readr::read_csv('../results/data_fdp.csv')
coal_data <- readr::read_csv('../results/data_coal.csv') %>% select(index_coal = index_party, sent)
gruene_data <- readr::read_csv('../results/data_gruene.csv')
spd_data <- readr::read_csv('../results/data_spd.csv')
fdp_long <- fdp_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_party) %>%
slice_max(n = 3, order_by = value)
spd_long <- spd_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_party) %>%
slice_max(n = 3, order_by = value)
gruene_long <- gruene_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_party) %>%
slice_max(n = 3, order_by = value)
fdp_long <- fdp_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_party) %>%
slice_max(n = 3, order_by = value) %>%
left_join(coal_data) %>%
left_join(fdp_data)
fdp_long <- fdp_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_party) %>%
slice_max(n = 3, order_by = value) %>%
mutate(index_coal = as.numeric(index_coal)) %>%
left_join(coal_data) %>%
left_join(fdp_data)
fdp_long <- fdp_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_party) %>%
slice_max(n = 3, order_by = value) %>%
mutate(index_coal = as.numeric(index_coal)) %>%
ungroup() %>%
left_join(coal_data %>% rename(sent_coal = sent), by = 'index_coal') %>%
left_join(fdp_data %>% rename(sent_party = sent), by = 'index_party')
View(fdp_long)
fdp_long <- fdp_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_party) %>%
slice_max(n = 3, order_by = value) %>%
mutate(index_coal = as.numeric(index_coal)) %>%
ungroup() %>%
left_join(coal_data %>% rename(sent_coal = sent), by = 'index_coal') %>%
left_join(fdp_data %>% rename(sent_party = sent), by = 'index_party')
spd_long <- spd_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_party) %>%
slice_max(n = 3, order_by = value)  %>%
mutate(index_coal = as.numeric(index_coal)) %>%
ungroup() %>%
left_join(coal_data %>% rename(sent_coal = sent), by = 'index_coal') %>%
left_join(spd_data %>% rename(sent_party = sent), by = 'index_party')
gruene_long <- gruene_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_party) %>%
slice_max(n = 3, order_by = value) %>%
mutate(index_coal = as.numeric(index_coal)) %>%
ungroup() %>%
left_join(coal_data %>% rename(sent_coal = sent), by = 'index_coal') %>%
left_join(gruene_data %>% rename(sent_party = sent), by = 'index_party')
fdp_long <- fdp_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_coal) %>%
slice_max(n = 3, order_by = value) %>%
mutate(index_coal = as.numeric(index_coal)) %>%
ungroup() %>%
left_join(coal_data %>% rename(sent_coal = sent), by = 'index_coal') %>%
left_join(fdp_data %>% rename(sent_party = sent), by = 'index_party')
spd_long <- spd_matrix %>%
select(-X1) %>%
pivot_longer(cols = c(-index_party),names_to = 'index_coal') %>%
group_by(index_coal) %>%
slice_max(n = 3, order_by = value)  %>%
mutate(index_coal = as.numeric(index_coal)) %>%
ungroup() %>%
left_join(coal_data %>% rename(sent_coal = sent), by = 'index_coal') %>%
left_join(spd_data %>% rename(sent_party = sent), by = 'index_party')
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
getwd()
